"use strict";function Panel(b,a,f,c,i,g,d){var h=this;c=c||0;i=i||0;g=g||0;d=d||0;this.panelInitString=b;this.panelSide=b.group||0;this.isLegendRequired=f;this.meta=global.facts[h.panelSide].reportMeta;this.containerId="#container"+h.panelSide;this.divPosition=(b.position!==undefined)?b.position:d3.selectAll(h.containerId+" .panel.single")[0].length;this.panelId="#panel"+h.panelSide+"P"+h.divPosition;this.mediator=a;this.data;this.dimsToShow=[];this.valMultiplier=1;this.valFraction=false;this.inPanic=false;this.mediatorIds=[];this.replaceFunction;this.margin={top:global.panelTitleHeight+3*global.legendOffsetY+g,right:global.legendOffsetX+i,bottom:d+((f)?global.legendHeight+2*global.legendOffsetY:global.legendOffsetY+global.legendHeight/2),left:global.legendOffsetX+c};this.width=h.w-h.margin.left-h.margin.right;this.height=h.h-h.margin.top-h.margin.bottom;this.panelDiv=d3.select(h.containerId).append("html:div").attr("id",h.panelId.substring(1)).attr("class","panel single");this.svg=h.panelDiv.append("svg:svg").attr("width",h.w).attr("height",h.h);this.gLegend=h.svg;var e=h.mediator.subscribe("killPanel",function(j){h.killPanel(j)});h.mediatorIds.push({channel:"killPanel",id:e.id});this.titleBox=new TitleBox(h.svg,h.panelId,h.mediator);h.titleBox.gContainer.classed("listener",true).on("mouseover",function(){h.hoverOn(this)}).on("mouseout",function(){h.hoverOff()})}Panel.prototype.w=global.panelWidth;Panel.prototype.h=global.panelHeight;Panel.prototype.legendWidth=global.panelWidth-2*global.legendOffsetX;Panel.prototype.defaultPanicText="<html>Nincs megjeleníthető adat.<html>";Panel.prototype.classedDarkenable=function(){d3.select(this).classed("darkenable",true)};Panel.prototype.cmp=function(d,c){return d.dims[0].name.localeCompare(c.dims[0].name)};Panel.prototype.createTooltip=function(i,f){var g="";var c="<html><h4>";for(var h=0,b=i.length;h<b;h++){c=c+g+i[h].name;if(i[h].value!==undefined){c+=": <em>"+i[h].value+"</em>"}g="<br />"}c=c+"</h4>";for(var a=0,e=f.length;a<e;a++){c=c+f[a].name+": <em>"+global.cleverRound5(f[a].value)+"</em> ("+f[a].dimension+")";if(f[a].avgValue!==undefined){c=c+"<em> átlag: "+global.cleverRound5(f[a].avgValue)+"</em>"}c=c+"<br />"}c=c+"</html>";return c};Panel.prototype.killListeners=function(){this.panelDiv.selectAll(".listener").on("click",null).on("mouseover",null).on("mouseout",null)};Panel.prototype.killPanel=function(c){if(c===undefined||c===this.panelId){this.mediator.publish("register",undefined,this.panelId);this.killListeners();for(var b=0,a=this.mediatorIds.length;b<a;b++){this.mediator.remove(this.mediatorIds[b].channel,this.mediatorIds[b].id)}this.mediatorIds=[];var e=parseInt(this.panelDiv.style("width"))/2;var d=parseInt(this.panelDiv.style("height"))/2;this.panelDiv.style(global.getStyleForScale(1,e,d)).style("opacity","1").transition().duration(global.selfDuration).style(global.getStyleForScale(0,e,d)).style("opacity","0").remove().each("end",global.mainToolbar_refreshState);$(window).trigger("resize")}};Panel.prototype.panic=function(c,d){var b=this;if(b.inPanic!==c){b.inPanic=c;if(c){b.svg.selectAll(".panic").on("click",null).style("opacity",0).remove();var a=b.svg.insert("svg:g",".title_group").attr("class","panic listener").style("opacity",0).on("click",function(){b.drill()});a.append("svg:g").append("svg:rect").attr("width",b.w).attr("height",b.h).attr("rx",global.rectRounding).attr("ry",global.rectRounding);a.selectAll("text").data([{tooltip:d||b.defaultPanicText}]).enter().append("svg:text").attr("x",b.w/2).attr("y",b.h/2).attr("text-anchor","middle").attr("dy","0.38em").attr("font-size",b.h*0.8).text("?");a.transition().duration(global.selfDuration).style("opacity",1)}else{b.svg.selectAll(".panic").on("click",null).transition().duration(global.selfDuration).style("opacity",0).remove()}}if(d){b.svg.selectAll(".panic").selectAll("text").data([{tooltip:d||b.defaultPanicText}])}};Panel.prototype.drill=function(){return};Panel.prototype.hoverOn=function(e,c){if(global.dragDropManager.draggedId!==null){var a=d3.select(e).select("rect");var b=(a.attr("transform")!==null)?a.attr("transform"):d3.select(e).attr("transform");var d=this;global.dragDropManager.targetObject=e;global.dragDropManager.targetPanelId=d.panelId;global.dragDropManager.targetId=c;global.dragDropManager.targetSide=parseInt(d.panelId.replace(/(^.+\D)(\d+)(\D.+$)/i,"$2"));if(global.dragDropManager.draggedMatchesTarget()){d.svg.append("svg:rect").attr("class","hoveredDropTarget").attr("width",a.attr("width")).attr("height",a.attr("height")).attr("transform",b).attr("rx",a.attr("rx")).attr("ry",a.attr("ry")).attr("x",a.attr("x")).attr("y",a.attr("y")).attr("fill","url(#diagonal)")}}};Panel.prototype.hoverOff=function(){if(global.dragDropManager.targetObject!==null){global.dragDropManager.targetObject=null;global.dragDropManager.targetPanelId=null;global.dragDropManager.targetId=null;this.svg.select(".hoveredDropTarget").remove()}};Panel.prototype.getConfig=function(){var b=this.constructorName+"({";var d="";for(var c in this.actualInit){var e=this.actualInit[c];var a=this.defaultInit[c];if(this.actualInit.hasOwnProperty(c)&&e!==undefined&&c!=="position"&&JSON.stringify(e)!==JSON.stringify(a)){if(e instanceof Array){b=b+d+c+": ["+e+"]";d=", "}else{b=b+d+c+": "+e;d=", "}}}b=b+"})";return b};