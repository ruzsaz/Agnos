"use strict";function HeadPanel_Report(n,l){var f=this;HeadPanel.call(this,n,global.mediators[n.group],"reportHeadPanel");this.meta=l;f.mediator.publish("register",f,f.panelId,[],f.preUpdate,f.update);f.divTableBase.append("html:div").attr("class","mainTitle").append("html:text").text(l.description);var h=f.divTableBase.append("html:div").attr("id","dimHolderP"+f.panelSide).attr("class","halfHeadDim halfHead");this.dimTable=h.append("html:div").attr("class","tableScrollPane").append("html:div").attr("class","table dimTable").attr("id","dimsTableP"+f.panelSide);var i=f.dimTable.append("html:div").attr("class","heading");i.append("html:div").attr("class","cell").text("Dimenzió neve");i.append("html:div").attr("class","cell").text("Lefúrási szint");i.append("html:div").attr("class","cell");h.transition().duration(global.selfDuration).style("opacity","1");var c=f.divTableBase.append("html:div").attr("id","tableHolderP"+f.panelSide).attr("class","halfHeadValue halfHead");this.valTable=c.append("html:div").attr("class","tableScrollPane").append("html:div").attr("class","table valTable").attr("id","reportsTableP"+f.panelSide);var j=f.valTable.append("html:div").attr("class","heading");var e=j.append("html:div").attr("class","cell");e.append("html:text").text("Mutató neve").attr("class","realText");e.append("html:text").text("ArányosítottMérték k k k k k k k k k k k k k k k k k k k k k").attr("class","dummyText");var a=j.append("html:div").attr("class","cell");a.append("html:text").text("Érték").attr("class","realText");a.append("html:text").text("ArányosítottMérték").attr("class","dummyText");var m=j.append("html:div").attr("class","cell");m.append("html:text").text("Arányosított érték").attr("class","realText");m.append("html:text").text("ArányosítottMérték").attr("class","dummyText");j.append("html:div").attr("class","cell");c.transition().duration(global.selfDuration).style("opacity","1");var b=f.dimTable.selectAll(".row").data(f.meta.dimensions);var d=b.enter().append("html:div").attr("class","row alterColored").attr("parity",function(p,o){return o%2});var g;g=d.append("html:div").attr("class","cell");g.append("html:text").attr("class","tableText0").text(function(o){return o.caption});g.append("html:text").attr("class","tableText0 spacer").text(function(o){return o.caption});g.append("html:span").html("&nbsp;");g=d.append("html:div").attr("class","cell");g.append("html:text").attr("class","tableText1").text(function(o){return o.topLevelName});g.append("html:text").attr("class","tableText1 spacer").text(function(o){return o.topLevelName});g.append("html:span").html("&nbsp;");d.append("html:div").attr("class","cell backgroundCell listener dragable");var k=f.valTable.selectAll(".row").data(f.meta.indicators).enter().append("html:div").attr("class","row");g=k.append("html:div").attr("class","cell hoverable listener dragable").on("click",function(o){f.mediator.publish("changeValue",undefined,o.id,false)});g.append("html:text").attr("class","tableText0").text(function(o){return o.caption});g.append("html:text").attr("class","tableText0 spacer").text(function(o){return o.caption});g.append("html:span").html("&nbsp;");g=k.append("html:div").attr("class","cell hoverable listener dragable").on("click",function(o){f.mediator.publish("changeValue",undefined,o.id,false)});g.append("html:text").attr("class","tableText1");g.append("html:text").attr("class","tableText1 spacer").text(function(o){return(o.value.hide)?"nem értelmezett":"99.9Mrd "+o.value.unit});g.append("html:span").html("&nbsp;");g=k.append("html:div").attr("class","cell hoverable listener dragable").on("click",function(o){f.mediator.publish("changeValue",undefined,o.id,true)});g.append("html:text").attr("class","tableText2");g.append("html:text").attr("class","tableText2 spacer").text(function(o){return(o.fraction.hide)?"nem értelmezett":"99.9Mrd "+o.fraction.unit});g.append("html:span").html("&nbsp;");k.append("html:div").attr("class","cell backgroundCell").style("background",function(p,o){return global.colorValue(o)});f.mediator.publish("magnify",0);f.mediator.publish("addDrag",f.divTableBase.selectAll(".dragable"))}HeadPanel_Report.prototype=global.subclassOf(HeadPanel);HeadPanel_Report.prototype.valToShow=function(c,a,b){var d="";if(c!==undefined&&c.rows[0]!==undefined&&c.rows[0].vals[b]!==undefined){d=(a.hide)?"nem értelmezett":global.cleverRound3(c.rows[0].vals[b].sz)+" "+a.unit}else{d="??? "+a.unit}return d};HeadPanel_Report.prototype.ratioToShow=function(c,a,b){var d="";if(c!==undefined&&c.rows[0]!==undefined&&c.rows[0].vals[b]!==undefined){d=(a.hide)?"nem értelmezett":global.cleverRound3(a.multiplier*c.rows[0].vals[b].sz/c.rows[0].vals[b].n)+" "+a.unit}else{d="??? "+a.unit}return d};HeadPanel_Report.prototype.preUpdate=function(a){this.dimTable.selectAll(".row:nth-child("+(a.dim+2)+")").select(".tableText1").style("opacity",0);if(a.direction!==0){this.valTable.selectAll(".row").selectAll(".tableText2, .tableText1").style("opacity",0)}};HeadPanel_Report.prototype.prepareData=function(g){var f=this;var d=[];var c=[];for(var e=0,b=(global.baseLevels[f.panelSide]).length;e<b;e++){var a=(global.baseLevels[f.panelSide])[e];d.push({text:(a.length===0)?f.meta.dimensions[e].top_level_caption:a[a.length-1].name.trim()})}f.dimTable.selectAll(".row").data(d).attr("tooltip",function(k,j){return"<html><h4>"+f.meta.dimensions[j].description+": <em>"+k.text+"</em></h4></html>"});for(var e=0,b=f.meta.indicators.length;e<b;e++){var h=f.meta.indicators[e];c.push({value:f.valToShow(g,h.value,e),ratio:f.ratioToShow(g,h.fraction,e)})}f.valTable.selectAll(".row").data(c).attr("tooltip",function(k,j){return"<html><h4>"+f.meta.indicators[j].description+"</h4></html>"});return{dimData:d,valData:c}};HeadPanel_Report.prototype.update=function(d){var c=this;var e=c.prepareData(d);var a=c.dimTable.selectAll(".row").data(e.dimData);a.select(".tableText1:not(.spacer)").style("opacity",function(f){return(f.text===d3.select(this).text())?1:0}).text(function(f){return f.text}).transition().duration(global.selfDuration).style("opacity",1);a.select(".tableText1.spacer").style("opacity",function(f){return(f.text===d3.select(this).text())?1:0}).text(function(f){return f.text});var b=c.valTable.selectAll(".row").data(e.valData);b.select(".tableText1:not(.spacer)").style("opacity",function(f){return(f.value===d3.select(this).text())?1:0}).text(function(f){return f.value}).transition().duration(global.selfDuration).style("opacity",1);b.select(".tableText2:not(.spacer)").style("opacity",function(f){return(f.ratio===d3.select(this).text())?1:0}).text(function(f){return f.ratio}).transition().duration(global.selfDuration).style("opacity",1);c.mediator.publish("magnify",0)};