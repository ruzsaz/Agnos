"use strict";function DataDirector(a,c){var b=this;this.side=a;this.mediator=c;this.panelRoster=[];b.mediator.subscribe("register",function(f,e,g,d,h,i){b.register(f,e,g,d,h,i)});b.mediator.subscribe("drill",function(d){b.drill(d)});b.mediator.subscribe("getConfig",function(d){b.getConfigs(d)})}DataDirector.prototype.register=function(a,c,e,j,h,k){var i=global.positionInArrayByProperty(this.panelRoster,"panelId",c);if(i>=0){this.panelRoster.splice(i,1)}if(a!==undefined){var b=[];for(var f=0,g=global.facts[this.side].reportMeta.dimensions.length;f<g;f++){b.push((e.indexOf(f)>-1)?1:0)}this.panelRoster.push({context:a,panelId:c,dimsToShow:b,preUpdateFunction:j,updateFunction:h,getConfigFunction:k,data:undefined})}};DataDirector.prototype.getFirstFreeIndex=function(){for(var a=0;a<global.maxPanelCount;a++){var b="#panel"+this.side+"P"+a;if(global.positionInArrayByProperty(this.panelRoster,"panelId",b)===-1){return a}}return -1};DataDirector.prototype.guessDimension=function(e){var j=global.facts[this.side].reportMeta;var f=-1;var a=10000;for(var h=0,i=j.dimensions.length;h<i;h++){var c=(h===e)?1000+h/100:h/100;for(var b=0,g=this.panelRoster.length;b<g;b++){c+=this.panelRoster[b].dimsToShow[h]}if(c<a){f=h;a=c}}return f};DataDirector.prototype.getNumberOfPanels=function(){return this.panelRoster.length};DataDirector.prototype.drill=function(b){var c=false;var d=b.dim;var a=(global.baseLevels[this.side])[d];if(b.direction===-1){if(b.toId!==undefined&&a.length<global.facts[this.side].reportMeta.dimensions[d].levels.length-1){c=true;b.fromId=(a.length===0)?null:(a[a.length-1]).id;a.push({id:b.toId,name:b.toName})}}else{if(b.direction===1){if(a.length>0){c=true;b.fromId=(a[a.length-1]).id;a.pop();b.toId=(a.length===0)?null:(a[a.length-1]).id}}else{if(b.direction===0){c=true}}}if(c){this.requestNewData(b);this.initiatePreUpdates(b)}};DataDirector.prototype.initiatePreUpdates=function(b){for(var c=0,a=this.panelRoster.length;c<a;c++){this.panelRoster[c].preUpdateFunction.call(this.panelRoster[c].context,this.getPanelDrill(c,b))}};DataDirector.prototype.requestNewData=function(b){var n=this;var i=global.facts[n.side].reportMeta.cube_unique_name;var t="";var g="";for(var q=0,s=(global.baseLevels[n.side]).length;q<s;q++){var e="";t+=g;for(var h=0,o=(global.baseLevels[n.side])[q].length;h<o;h++){t+=e+((global.baseLevels[n.side])[q])[h].id;e=","}g=":"}var j=[];for(var a=0,m=this.panelRoster.length;a<m;a++){j.push(this.panelRoster[a].dimsToShow.toString().replace(/,/g,":"))}var k=j.filter(function(l,d){return j.indexOf(l)===d});var f=k.toString().replace(/,/g,";");var r=i+";"+t+";"+f;var c="queries="+window.btoa(r);global.get(global.url.fact,c,function(d,l){n.processNewData(b,d)})};DataDirector.prototype.processNewData=function(b,f){var d=f;for(var c=0,a=this.panelRoster.length;c<a;c++){var g=global.positionInArrayByProperty(d,"name",this.panelRoster[c].dimsToShow.toString().replace(/,/g,":"));var e=d[g].response;this.panelRoster[c].updateFunction.call(this.panelRoster[c].context,e,this.getPanelDrill(c,b))}global.getConfig2()};DataDirector.prototype.getPanelDrill=function(c,a){var b={dim:a.dim,direction:(this.panelRoster[c].dimsToShow[a.dim]===1)?a.direction:0,fromId:a.fromId,toId:a.toId};return b};DataDirector.prototype.getConfigs=function(f){var e="";var d="";for(var b=0,a=this.panelRoster.length;b<a;b++){if(typeof this.panelRoster[b].getConfigFunction==="function"){e=e+d+this.panelRoster[b].getConfigFunction.call(this.panelRoster[b].context);d=";"}}if(typeof f==="function"){var c={};if(global.facts[this.side]){c.s=this.side;c.c=global.facts[this.side].reportMeta.cube_unique_name;c.b=global.baseLevels[this.side];c.v=global.minifyInits(e)}f(c)}else{console.log(e)}};