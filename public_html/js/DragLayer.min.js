"use strict";function Draglayer(h,a){var f=this;var b=d3.select("#container"+h);var g=false;var c=b.append("html:div").attr("class","dragCircle");var e=function(l){if(d3.event.sourceEvent.which===1&&!g){var k=(l.value===undefined)?0:1;var j=d3.selectAll(this.parentNode.childNodes).filter(".backgroundCell");c.text(l.description);g=true;d3.event.sourceEvent.stopPropagation();d3.selectAll("svg > *:not(.droptarget"+k+")").style("pointer-events","none");d3.select(this).classed("dragging",true);c.style(global.getStyleForScale(1,1,1)).style("opacity",1).style("display","block").style("margin-left",((-parseFloat(c.style("width"))/2)-15)+"px").style("background-color",j.style("background-color")).style("color",j.style("color"));global.dragDropManager.draggedId=l.id;global.dragDropManager.draggedType=k;global.dragDropManager.draggedSide=h}};var i=function(){if(g){var j=d3.mouse(b.nodes()[0]);c.style("left",(j[0]/global.scaleRatio)+"px").style("top",(j[1]/global.scaleRatio)+"px").style("visibility","visible");d3.select(c.node().parentNode).classed("dragging",true)}};var d=function(){if(d3.event.sourceEvent.which===1&&g){var k=d3.select(global.dragDropManager.targetObject);if(!k.empty()){if(global.dragDropManager.draggedType===0){a.publish("changeDimension",global.dragDropManager.targetPanelId,global.dragDropManager.draggedId,global.dragDropManager.targetId)}else{if(global.dragDropManager.draggedType===1){a.publish("changeValue",global.dragDropManager.targetPanelId,global.dragDropManager.draggedId,undefined,global.dragDropManager.targetId)}}}d3.select(this).classed("dragging",false);d3.selectAll("svg > *").style("pointer-events",null);var j=parseInt(c.style("width"))/2;var l=parseInt(c.style("height"))/2;c.style(global.getStyleForScale(1,j,l)).transition().duration(global.selfDuration/2).style(global.getStyleForScale(0,j,l)).style("opacity",0).each("end",function(){d3.select(this).style("display",null).style("visibility",null);g=false});global.dragDropManager.draggedId=null;global.dragDropManager.draggedType=null;global.dragDropManager.draggedSide=null;d3.select(c.node().parentNode).classed("dragging",false)}};this.drag=d3.behavior.drag().on("dragstart",e).on("drag",i).on("dragend",d);a.subscribe("addDrag",function(j){f.addDragBehavior(j)})}Draglayer.prototype.addDragBehavior=function(a){a.call(this.drag)};