"use strict";function panel_table1d(m){var j=this;this.constructorName="panel_table1d";this.defaultInit={group:0,position:undefined,dim:0,multiplier:1,ratio:false};this.actualInit=global.combineObjects(j.defaultInit,m);Panel.call(j,j.actualInit,global.mediators[j.actualInit.group],false,0,0);this.dimToShow=j.actualInit.dim;this.preparedData=[];this.maxEntries=global.maxEntriesIn1D;this.columnHeadVector=[];this.columnColorIndex=[];var f=[];var b=[];this.valuePositionVector=[];var k=0;for(var h=0,g=j.meta.indicators.length;h<g;h++){var e=j.meta.indicators[h];j.columnHeadVector.push({hide:((e.value.hide)?1:0)+((e.fraction.hide)?2:0),tooltip:j.createTooltip([{name:j.meta.indicators[h].description}],[])});this.valuePositionVector.push(k);if(j.columnHeadVector[h].hide!==3){f.push(h);b.push(j.meta.indicators[h].caption);k+=(j.columnHeadVector[h].hide===0)?2:1;if(j.columnHeadVector[h].hide%2===0){j.columnColorIndex.push(d3.rgb(global.colorValue(h)).brighter(j.darkenBrightenFactor))}if(j.columnHeadVector[h].hide>>1===0){j.columnColorIndex.push(d3.rgb(global.colorValue(h)).darker(j.darkenBrightenFactor))}}}j.titleBox.titleSplitRatio=1;j.titleBox.update(f,b,[],[],true,global.selfDuration);j.titleBox.gContainer.classed("droptarget",false);j.titleBox.gContainer.classed("droptarget1",false);j.svg.insert("svg:g",".title_group").attr("class","background listener droptarget droptarget0").on("mouseover",function(){j.hoverOn(this)}).on("mouseout",function(){j.hoverOff()}).on("click",function(){j.drill()}).append("svg:rect").attr("width",j.w).attr("height",j.h);var a=j.svg.insert("svg:g",".title_group").attr("class","svgTableHolder").attr("transform","translate("+j.tableLeftMargin+","+j.tableTopMargin+")");this.gRowHeads=a.append("svg:svg").attr("x",0).attr("y",j.tableHeadHeight+j.tableElementGap).attr("width",j.tableHeadWidth).attr("height",j.tableHeight).attr("viewBox","0 0 "+j.tableHeadWidth+" "+j.tableHeight);this.gColumnHeads=a.append("svg:svg").attr("x",j.tableHeadWidth+j.tableElementGap).attr("y",0).attr("width",j.tableWidth).attr("height",j.tableHeadHeight).attr("viewBox","0 0 "+j.tableWidth+" "+j.tableHeadHeight);this.gTable=a.append("svg:svg").attr("x",j.tableHeadWidth+j.tableElementGap).attr("y",j.tableHeadHeight+j.tableElementGap).attr("width",j.tableWidth).attr("height",j.tableHeight).attr("viewBox","0 0 "+j.tableWidth+" "+j.tableHeight);var c=function(){var n=this.scrollTop;var i=j.gTable.attr("viewBox").split(" ");j.gRowHeads.attr("viewBox","0 "+n+" "+j.tableHeadWidth+" "+j.tableHeight);j.gTable.attr("viewBox",i[0]+" "+n+" "+j.tableWidth+" "+j.tableHeight)};var l=function(){var n=this.scrollLeft;var i=j.gTable.attr("viewBox").split(" ");j.gColumnHeads.attr("viewBox",n+" 0 "+j.tableWidth+" "+j.tableHeadHeight);j.gTable.attr("viewBox",n+" "+i[1]+" "+j.tableWidth+" "+j.tableHeight)};this.horizontalScrollbar=new SVGScrollbar(d3.select(j.panelId),true,j.tableWidth,l);j.horizontalScrollbar.setPosition(j.tableHeadWidth+j.tableLeftMargin+j.tableElementGap,400-j.tableBottomMargin-global.scrollbarWidth);j.horizontalScrollbar.set(j.columnColorIndex.length*j.tableSpacingHorizontal,null,0);this.verticalScrollbar=new SVGScrollbar(d3.select(j.panelId),false,j.tableHeight,c);j.verticalScrollbar.setPosition(600-j.tableLeftMargin-global.scrollbarWidth,j.tableHeadHeight+j.tableTopMargin+j.tableElementGap);var d=j.mediator.subscribe("changeDimension",function(i,n,o){j.doChangeDimension(i,n,o)});j.mediatorIds.push({channel:"changeDimension",id:d.id});j.mediator.publish("register",j,j.panelId,[j.dimToShow],j.preUpdate,j.update,j.getConfig);j.drawColumnHeaders(global.getAnimDuration(-1,j.panelId))}panel_table1d.prototype=global.subclassOf(Panel);panel_table1d.prototype.tableHeadWidth=120;panel_table1d.prototype.tableHeadHeight=34;panel_table1d.prototype.tableElementGap=4;panel_table1d.prototype.tableLeftMargin=40;panel_table1d.prototype.tableTopMargin=70;panel_table1d.prototype.tableBottomMargin=15;panel_table1d.prototype.tableWidth=600-2*(panel_table1d.prototype.tableLeftMargin+panel_table1d.prototype.tableElementGap)-panel_table1d.prototype.tableHeadWidth-global.scrollbarWidth;panel_table1d.prototype.tableHeight=400-panel_table1d.prototype.tableTopMargin-panel_table1d.prototype.tableHeadHeight-panel_table1d.prototype.tableBottomMargin-global.scrollbarWidth-2*panel_table1d.prototype.tableElementGap;panel_table1d.prototype.tableSpacingVerical=panel_table1d.prototype.tableHeight/14;panel_table1d.prototype.tableSpacingHorizontal=panel_table1d.prototype.tableWidth/7;panel_table1d.prototype.darkenBrightenFactor=0.25;panel_table1d.prototype.valuesToShow=function(g){var c=this;var e=[];if(g!==undefined&&g.vals!==undefined){for(var b=0,a=g.vals.length;b<a;b++){if(c.columnHeadVector[b].hide%2===0){var f=g.vals[b].sz;if(isNaN(parseFloat(f))){f=0}e.push({value:f,tooltip:c.createTooltip([{name:c.meta.dimensions[c.dimToShow].description,value:(g.dims[0].name!==undefined)?g.dims[0].name:"Nincs adat"}],[{name:c.meta.indicators[b].description,value:f,dimension:c.meta.indicators[b].value.unit}])})}if(c.columnHeadVector[b].hide>>1===0){var f=c.meta.indicators[b].fraction.multiplier*g.vals[b].sz/g.vals[b].n;if(isNaN(parseFloat(f))){f=0}e.push({value:f,tooltip:c.createTooltip([{name:c.meta.dimensions[c.dimToShow].description,value:(g.dims[0].name!==undefined)?g.dims[0].name:"Nincs adat"}],[{name:c.meta.indicators[b].description,value:f,dimension:c.meta.indicators[b].fraction.unit}])})}}}return e};panel_table1d.prototype.preUpdate=function(a){var b=this;if(a.dim===b.dimToShow){if(a.direction===-1){b.gRowHeads.selectAll(".svgRowHead").filter(function(c){return(c.id!==a.toId)}).remove();b.gTable.selectAll(".svgTableRow").filter(function(c){return(c.id!==a.toId)}).remove()}else{if(a.direction===1){if((global.baseLevels[b.panelSide])[b.dimToShow].length+2!==b.meta.dimensions[b.dimToShow].levels.length){b.gRowHeads.selectAll(".svgRowHead").remove();b.gTable.selectAll(".svgTableRow").remove()}}}}};panel_table1d.prototype.prepareData=function(f,g,h){var o=this;var e=(global.baseLevels[o.panelSide])[o.dimToShow].length;g.sort(o.cmp);var q=[];for(var l=0;l<g.length;l++){var p=g[l];var m=p.dims[0];var k={index:l,oldRowIndex:l,id:m.id,uniqueId:e+"L"+m.id,name:m.name.trim(),values:o.valuesToShow(p),startOpacity:0};k.tooltip=o.createTooltip([{name:o.meta.dimensions[o.dimToShow].description,value:(k.name)?k.name:"Nincs adat"}],[]);q.push(k)}if(f&&h.dim===o.dimToShow&&h.direction===-1){var c=global.getFromArrayByProperty(f,"id",h.toId).index;for(var b=0,a=q.length;b<a;b++){q[b].oldRowIndex=c;q[b].startOpacity=(1/a)+0.2}}else{if(f&&h.dim===o.dimToShow&&h.direction===1){var j=(f.length-1)/2;var n=global.getFromArrayByProperty(q,"id",h.fromId).index;for(var b=0,a=q.length;b<a;b++){q[b].oldRowIndex=(q[b].index-n)*5+j;q[b].startOpacity=(q[b].index===n)?1:0}}}return q};panel_table1d.prototype.update=function(d,a){var c=this;c.data=d||c.data;a=a||{dim:-1,direction:0};var b=global.getAnimDuration(-1,c.panelId);if(c.data.rows.length>c.maxEntries){c.verticalScrollbar.set(0,null,b);c.panic(true,"<html>A panel nem képes "+c.data.rows.length+" értéket megjeleníteni.<br />A maximálisan megjeleníthető értékek száma "+c.maxEntries+".</html>");c.preparedData=undefined}else{c.panic(false);c.preparedData=c.prepareData(c.preparedData,c.data.rows,a);c.drawRowHeaders(c.preparedData,b);c.drawCells(c.preparedData,b);c.verticalScrollbar.set(c.preparedData.length*c.tableSpacingVerical,null,b)}};panel_table1d.prototype.drawCells=function(f,c){var b=this;var e=b.gTable.selectAll(".svgTableRow").data(f,function(g){return g.name});e.enter().append("svg:g").attr("class","svgTableRow").attr("transform",function(g){return"translate(0,"+(g.oldRowIndex*b.tableSpacingVerical)+")"}).attr("opacity",function(g){return g.startOpacity});e.transition().duration(c).attr("transform",function(g){return"translate(0, "+g.index*b.tableSpacingVerical+")"}).attr("opacity",1);e.exit().remove();var a=e.selectAll(".svgTableCell").data(function(g){return g.values});var d=a.enter().append("svg:g").attr("class","svgTableCell showValue").attr("transform",function(h,g){return"translate("+(g*b.tableSpacingHorizontal)+",0)"});d.append("svg:rect").attr("class","backgroundRect").attr("width",b.tableSpacingHorizontal).attr("height",b.tableSpacingVerical);d.append("svg:text").attr("x",b.tableSpacingHorizontal/2).attr("y",b.tableSpacingVerical/2).attr("dy",".35em");a.exit().remove();a.select("rect").attr("fill",function(k,h,g){return(g%2===0)?b.columnColorIndex[h].brighter(b.darkenBrightenFactor):b.columnColorIndex[h].darker(b.darkenBrightenFactor)});a.select("text").attr("opacity",function(g){return(global.cleverRound5(g.value)===d3.select(this).text())?1:0}).text(function(g){return global.cleverRound5(g.value)}).transition().duration(c).attr("opacity",1)};panel_table1d.prototype.drawColumnHeaders=function(b){var a=this;var d=a.gColumnHeads.selectAll(".svgColumnHead").data(a.columnHeadVector);var c=d.enter().append("svg:g").attr("class","svgColumnHead showValue").attr("transform",function(f,e){return"translate("+(a.valuePositionVector[e]*a.tableSpacingHorizontal)+",0)"}).attr("opacity",0);c.append("svg:rect").attr("class","backgroundRect").attr("width",function(e){return(e.hide!==3)?(((e.hide===0)?2:1)*a.tableSpacingHorizontal):0}).attr("height",a.tableHeadHeight/2).style("fill",function(f,e){return global.colorValue(e)});c.append("svg:text").attr("opacity",1).attr("class","svgColumnHeadLabel svgTableHeadLabel").attr("x",function(e){return(e.hide===0)?a.tableSpacingHorizontal:a.tableSpacingHorizontal/2}).attr("y",a.tableHeadHeight/4).attr("dy","0.35em").attr("dx","0em").classed("double",function(e){return(e.hide===0)}).text(function(f,e){return(f.hide!==3)?a.meta.indicators[e].caption:""});c.append("svg:rect").attr("class","backgroundRect").attr("width",function(f,e){return(f.hide%2===0)?a.tableSpacingHorizontal:0}).attr("height",a.tableHeadHeight/2).attr("y",a.tableHeadHeight/2).style("fill",function(f,e){return d3.rgb(global.colorValue(e)).brighter(a.darkenBrightenFactor)});c.append("svg:text").attr("opacity",1).attr("class","svgColumnHeadLabel svgTableHeadLabel").attr("x",a.tableSpacingHorizontal/2).attr("y",3*a.tableHeadHeight/4).attr("dy","0.35em").attr("dx","0em").text(function(f,e){return(f.hide%2===0)?a.meta.indicators[e].value.unit:""});c.append("svg:rect").attr("class","backgroundRect").attr("width",function(e){return(e.hide>>1===0)?a.tableSpacingHorizontal:0}).attr("height",a.tableHeadHeight/2).attr("y",a.tableHeadHeight/2).attr("x",function(f,e){return(f.hide%2===0)?a.tableSpacingHorizontal:0}).style("fill",function(f,e){return d3.rgb(global.colorValue(e)).darker(a.darkenBrightenFactor)});c.append("svg:text").attr("opacity",1).attr("class","svgColumnHeadLabel svgTableHeadLabel").attr("x",function(e){return((e.hide%2===0)?3:1)*a.tableSpacingHorizontal/2}).attr("y",3*a.tableHeadHeight/4).attr("dy","0.35em").attr("dx","0em").text(function(f,e){return(f.hide>>1===0)?a.meta.indicators[e].fraction.unit:""});d.transition().duration(b).attr("opacity",1);global.cleverCompress(a.gColumnHeads.selectAll("text.double"),2*a.tableSpacingHorizontal,0.85,1.4);global.cleverCompress(a.gColumnHeads.selectAll("text:not(.double)"),a.tableSpacingHorizontal,0.85,1.4)};panel_table1d.prototype.drawRowHeaders=function(e,c){var b=this;var d=b.gRowHeads.selectAll(".svgRowHead").data(e,function(f){return f.uniqueId+f.name});var a=d.enter().append("svg:g").attr("class","svgRowHead listener alterColored").on("click",function(f){b.drill(f)}).attr("transform",function(f){return"translate(0,"+(f.oldRowIndex*b.tableSpacingVerical)+")"}).attr("opacity",function(f){return f.startOpacity});a.append("svg:rect").attr("class","backgroundRect").attr("width",b.tableHeadWidth).attr("height",b.tableSpacingVerical);a.append("svg:text").attr("opacity",1).attr("class","svgRowHeadLabel svgTableHeadLabel").attr("y",b.tableSpacingVerical/2).attr("x",0).attr("dy","0.35em").attr("dx",".26em").text(function(f){return f.name});d.exit().on("click",null).remove();d.attr("parity",function(f){return f.index%2}).classed("darkenable",false).transition().duration(c).attr("opacity",1).attr("transform",function(f){return"translate(0, "+f.index*b.tableSpacingVerical+")"}).each("end",Panel.prototype.classedDarkenable);global.cleverCompress(b.gRowHeads.selectAll("text"),b.tableHeadWidth,0.94,1.4)};panel_table1d.prototype.drill=function(b){global.tooltip.kill();var a={dim:this.dimToShow,direction:(b===undefined)?1:-1,toId:(b===undefined)?undefined:b.id,toName:(b===undefined)?undefined:b.name};this.mediator.publish("drill",a)};panel_table1d.prototype.doChangeDimension=function(a,b){var c=this;if(a===c.panelId){c.dimToShow=b;c.actualInit.dim=c.dimToShow;c.mediator.publish("register",c,c.panelId,[c.dimToShow],c.preUpdate,c.update);global.tooltip.kill();this.mediator.publish("drill",{dim:-1,direction:0,toId:undefined})}};